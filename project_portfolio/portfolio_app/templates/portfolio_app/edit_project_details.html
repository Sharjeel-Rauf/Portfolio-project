
{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- Error messages -->
<div class="toast-container position-fixed top-0 end-0 p-3">
    {% for message in messages %}
    <div
      class="toast align-items-center {% if message.tags == 'error' %}bg-danger {% else %} bg-success {% endif %} border-0"
      role="alert" aria-live="assertive" aria-atomic="true" style="margin-top: 100px;">
      <div class="d-flex">
        <div class="toast-body" style="color: white;">
          {{ message }}
        </div>
        <button style="color: white; background-color: transparent;" type="button"
          class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
    {% endfor %}
    {% if form.python_file.errors %}
    <div class="toast align-items-center bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true"
      style="margin-top: 100px;">
      <div class="d-flex">
        <div class="toast-body" style="color: white;">
          {{ form.python_file.errors }}
        </div>
        <button style="color: white; background-color: transparent;" type="button"
          class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
    {% endif %}
  </div>






  <form method="post" action="{% url 'edit_details' detail.id %}" hx-post="{% url 'edit_details' detail.id %}" hx-target="#project_details" enctype="multipart/form-data">
    {% csrf_token %}
    <!-- Code Title Field -->
    <div class="textfield">
        <label for="{{ form.code_title.id_for_label }}">Code Title</label>
        {{ form.code_title }}
    </div>
    
    <!-- Description Field with character count -->
    <div class="textfield">
        <label for="{{ form.description.id_for_label }}">Description</label>
        {{ form.description }}
        <div id="description-char-count"></div> <!-- To display the character count -->
    </div>
    
    <!-- Python File Field -->
    <div class="filefield">
        <label for="{{ form.python_file.id_for_label }}">Python File</label>
        {{ form.python_file }}
    </div>
    <button type="submit" class="btn btn-primary">Save</button>
</form>
<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<!-- JavaScript for character count -->
<script>
    // Get the description field element
    var descriptionField = document.getElementById("{{ form.description.id_for_label }}");
    
    // Set the maximum length for the description field
    var maxLength = 500;
    
    // Function to update character count
    function updateCharCount() {
        var charCountElement = document.getElementById("description-char-count");
        var remainingChars = maxLength - descriptionField.value.length;
        charCountElement.textContent = remainingChars + " characters remaining";
    }
    
    // Bind input event listener to the description field
    descriptionField.addEventListener("input", function() {
        // Check if the description length exceeds the maximum length
        if (descriptionField.value.length > maxLength) {
            // Trim the description text to the maximum length
            descriptionField.value = descriptionField.value.slice(0, maxLength);
        }
        // Update character count
        updateCharCount();
    });
    
    // Initialize character count on page load
    updateCharCount();
</script>

 <!-- Include jQuery (if not already included) -->
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<!-- for toast -->
	<script>
		// Show toast when page loads
		document.addEventListener('DOMContentLoaded', function () {
			var toastElList = [].slice.call(document.querySelectorAll('.toast'));
			var toastList = toastElList.map(function (toastEl) {
				return new bootstrap.Toast(toastEl);
			});
			toastList.forEach(function (toast) {
				toast.show();
			});
		});
	</script>
			<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">	

{% endblock %}